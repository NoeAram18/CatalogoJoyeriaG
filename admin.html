<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gedalia Intelligence - Admin</title>
    <style>
        body { font-family: 'Inter', sans-serif; background: #f0f0f0; margin: 0; display: flex; }
        .sidebar { width: 250px; background: #000; height: 100vh; color: white; padding: 30px; position: fixed; }
        .main { margin-left: 250px; padding: 40px; width: 100%; }
        .card-stat { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        input, select, button { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .gold-btn { background: #c5a059; border: none; color: white; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="color:#c5a059">GEDALIA</h2>
    <p>Admin Dashboard</p>
    <hr style="border:0.5px solid #222; margin: 30px 0;">
    <button class="gold-btn" onclick="showSec('new')">A√±adir Joya</button>
    <button class="gold-btn" style="background:#222; margin-top:10px" onclick="showSec('stats')">Estad√≠sticas</button>
</div>

<div class="main">
    <div id="sec-stats">
        <h2>Inteligencia de Negocio</h2>
        <div class="grid-3">
            <div class="card-stat">
                <h3>M√°s Visto üî•</h3>
                <ul id="top-views"></ul>
            </div>
            <div class="card-stat">
                <h3>Ventas Recientes üõçÔ∏è</h3>
                <ul id="last-sales"></ul>
            </div>
        </div>
    </div>

    <div id="sec-new" class="card-stat">
        <h2>Publicar Nueva Pieza</h2>
        <div class="grid-3">
            <input type="text" id="n" placeholder="Nombre">
            <select id="c">
                <option value="Anillos">Anillo</option>
                <option value="Dije">Dije</option>
                <option value="Collares">Collar</option>
                <option value="Aretes">Aretes</option>
                <option value="Pulseras">Pulsera</option>
            </select>
            <input type="number" id="p" placeholder="Precio Base">
        </div>
        <div class="grid-3">
            <input type="number" id="desc" placeholder="% Descuento">
            <select id="env">
                <option value="false">Env√≠o Pagado</option>
                <option value="true">Env√≠o Gratis</option>
            </select>
        </div>
        <input type="text" id="i1" placeholder="URL Imagen 1">
        <input type="text" id="i2" placeholder="URL Imagen 2">
        <input type="text" id="i3" placeholder="URL Imagen 3">
        <button class="gold-btn" onclick="subir()">Lanzar Colecci√≥n</button>
    </div>
</div>

<script>
    async function loadStats() {
        const res = await fetch('/api/admin/stats');
        const data = await res.json();
        
        document.getElementById('top-views').innerHTML = data.masVistos.map(p => `
            <li style="margin-bottom:10px">${p.nombre} - <b>${p.vistas} vistas</b></li>
        `).join('');

        document.getElementById('last-sales').innerHTML = data.ventasRecientes.map(v => `
            <li style="margin-bottom:10px">${v.joya} - <span class="badge" style="background:#eee">$${v.monto}</span></li>
        `).join('');
    }

    async function subir() {
        const body = {
            nombre: document.getElementById('n').value,
            categoria: document.getElementById('c').value,
            precioBase: document.getElementById('p').value,
            descuento: document.getElementById('desc').value,
            envioGratis: document.getElementById('env').value === "true",
            imagenes: [document.getElementById('i1').value, document.getElementById('i2').value, document.getElementById('i3').value].filter(i => i)
        };
        await fetch('/api/admin/productos', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(body)
        });
        alert("¬°Pieza publicada!");
        loadStats();
    }

    function showSec(id) {
        document.getElementById('sec-stats').style.display = id === 'stats' ? 'block' : 'none';
        document.getElementById('sec-new').style.display = id === 'new' ? 'block' : 'none';
    }

    loadStats();
</script>
</body>
</html>
