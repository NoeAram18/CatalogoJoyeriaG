<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Joyería</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
        .catalog { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
        .item { background: white; padding: 10px; border: 2px solid transparent; border-radius: 10px; cursor: pointer; }
        .item.selected { border-color: #d4af37; background: #fffdf0; }
        .item img { width: 100%; border-radius: 5px; }
        #upload-section { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button { background: #d4af37; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>Elige tu Joya y Sube tu Foto</h1>

    <div id="upload-section">
        <h3>1. Selecciona del Catálogo:</h3>
        <div class="catalog" id="catalog">
            <div class="item" onclick="selectItem(this, 'images/anillo1.jpg')">
                <img src="images/anillo1.jpg" alt="Anillo Oro 1">
                <p>Anillo de Oro</p>
            </div>
            <div class="item" onclick="selectItem(this, 'images/anillo2.jpg')">
                <img src="images/anillo2.jpg" alt="Anillo de oro 2">
                <p>Collar de Plata</p>
            </div>
        </div>

        <h3>2. Sube tu foto (rostro/mano):</h3>
        <input type="file" id="userPhoto" accept="image/*"><br><br>

        <button onclick="enviarPedido()">Enviar a Diseñador</button>
        <p id="status"></p>
    </div>

    <script>
        let selectedCatalogImg = null;

        function selectItem(element, imgPath) {
            document.querySelectorAll('.item').forEach(i => i.classList.remove('selected'));
            element.classList.add('selected');
            selectedCatalogImg = imgPath;
        }

        async function enviarPedido() {
    const userPhotoInput = document.getElementById('userPhoto');
    const status = document.getElementById('status');

    if (!selectedCatalogImg || !userPhotoInput.files[0]) {
        alert("Por favor, selecciona una joya y sube tu foto.");
        return;
    }

    status.innerText = "Enviando pedido...";
    const formData = new FormData();
    
    // 1. Añadimos la foto del usuario
    formData.append('userImage', userPhotoInput.files[0]);
    
    // 2. Añadimos la ruta de la imagen del catálogo como texto 
    // (Es más seguro que intentar convertirla a Blob en el cliente)
    formData.append('catalogPath', selectedCatalogImg);

    try {
        const res = await fetch('/send-to-telegram', { 
            method: 'POST', 
            body: formData 
        });
        
        const data = await res.json();
        if (data.success) {
            status.innerHTML = "✅ ¡Enviado! El diseñador recibió todo.";
        } else {
            status.innerText = "❌ Error en el servidor: " + (data.error || 'Desconocido');
        }
    } catch (e) {
        status.innerText = "❌ Error de conexión con el servidor.";
    }
}
    </script>
</body>
</html>
